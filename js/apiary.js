var Apiary,Embed,slice=[].slice;null==window.Apiary&&(window.Apiary={}),Apiary=window.Apiary,Embed=function(){function Embed(options){var apiBlueprint,authorizationToken,base,codeExamples,customFonts,element,header,preferences,ref,subdomain,theme,token,uuid;this.options=null!=options?options:{},ref=this.options,codeExamples=ref.codeExamples,customFonts=ref.customFonts,element=ref.element,header=ref.header,preferences=ref.preferences,subdomain=ref.subdomain,uuid=ref.uuid,theme=ref.theme,apiBlueprint=ref.apiBlueprint,authorizationToken=ref.authorizationToken,token=ref.token,null==(base=this.options).preferences&&(base.preferences={}),this.initialized=!1,this.initElement(),this.initQueue(),this.attachEvents()}return Embed.prototype.ORIGIN="Apiary.Embed",Embed.prototype.ALLOWED_ORIGIN="Apiary",Embed.prototype.ELEMENT_NAME="iframe",Embed.prototype.DOM_READY_REG_EXP=new RegExp("^loaded|^i|^c"),Embed.prototype.JS_API_BASE_URL="https://jsapi.apiary.io/",Embed.prototype.log=function(){var logs;if(logs=1<=arguments.length?slice.call(arguments,0):[],this.options.debug)return logs=logs.map(function(log){return"‘Apiary.Embed:’ "+log}),console.debug.apply(console,logs)},Embed.prototype.attachEvents=function(){return this.log("Attaching events..."),this.DOM_READY_REG_EXP.test(document.readyState)?this.handleDomReadyEvent():document.addEventListener("DOMContentLoaded",this.handleDomReadyEvent.bind(this)),window.addEventListener("message",this.handleMessageEvent.bind(this)),window.addEventListener("resize",this.handleResizeEvent.bind(this))},Embed.prototype.handleDomReadyEvent=function(){return this.setSize()},Embed.prototype.handleMessageEvent=function(eventObject){var ref,ref1,ref2,ref3;if((null!=(ref=eventObject.data)?ref.origin:void 0)===this.ALLOWED_ORIGIN)switch(null!=(ref1=eventObject.data)?ref1.eventType:void 0){case"ready":return this.initEmbed(),this.processQueue();case"change:url":return this.changeHash(null!=(ref2=eventObject.data)&&null!=(ref3=ref2.eventData)?ref3.url:void 0)}},Embed.prototype.handleResizeEvent=function(){return this.setSize()},Embed.prototype.changeHash=function(hash){if(this.options.preferences.permalinks)return hash="/"+hash.split("/").slice(3).join("/"),hash=hash.replace(".html",""),window.location.hash=hash},Embed.prototype.getHost=function(){return window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search},Embed.prototype.getApiUrl=function(){var base,preferences,resource,url;return resource=this.options.token?"api-projects":"apis",url=this.options.subdomain||this.options.uuid?""+this.JS_API_BASE_URL+resource+"/"+(this.options.subdomain||this.options.uuid)+".html":this.JS_API_BASE_URL+"previews",null==(base=this.options).preferences&&(base.preferences={}),this.options.preferences.permalinks&&(this.options.preferences.permalinksHost=this.getHost()),preferences=JSON.stringify({documentation:this.options.preferences},function(key,value){return key?"documentation"===key&&"object"==typeof value?value:value===!0||value===!1?value:"number"==typeof value?value:"string"==typeof value?value:void 0:value}),url+="?preferences="+encodeURIComponent(preferences),this.options.token&&(url+="&token="+this.options.token),url},Embed.prototype.initQueue=function(){return this.queue=[]},Embed.prototype.processQueue=function(){return this.queue.forEach(function(_this){return function(arg){var args,methodName;return methodName=arg.methodName,args=arg.args,_this[methodName].apply(_this,args)}}(this))},Embed.prototype.initElement=function(){var element;return this.log("Initializing the ‘<iframe>’ element..."),this.options.header&&(this.headerElement=document.querySelector(this.options.header)),this.iframeElement=document.createElement(this.ELEMENT_NAME),this.iframeElement.src=this.getApiUrl(),this.iframeElement.frameBorder=0,this.options.element?(this.iframeElement.width="100%",this.iframeElement.height="100%"):(this.iframeElement.width="0px",this.iframeElement.height="0px"),this.iframeElement.style.display="block",element=this.options.element?document.querySelector(this.options.element):document.body,element.appendChild(this.iframeElement)},Embed.prototype.setSize=function(){var iframeHeight;if(!this.options.element)return this.iframeElement.width=window.innerWidth+"px",iframeHeight=window.innerHeight,this.options.header&&this.headerElement&&(iframeHeight-=this.headerElement.offsetHeight),this.iframeElement.height=iframeHeight+"px"},Embed.prototype.sendMessage=function(eventType,data){return this.iframeElement.contentWindow.postMessage({origin:this.ORIGIN,eventType:eventType,data:data},"*")},Embed.prototype.initEmbed=function(){var url;return this.log("Initializing embed..."),url="/apis/"+(this.options.subdomain||this.options.uuid),window.location.hash&&(url+=window.location.hash.slice(1)+".html"),this.options.apiBlueprint?this.sendMessage("anonymousPreview",{code:this.options.apiBlueprint,currentUrl:url,permalinksHost:this.getHost()}):this.options.authorizationToken?this.sendMessage("privateDocumentation",{token:this.options.authorizationToken,subdomain:this.options.subdomain||this.options.uuid,currentUrl:url,permalinksHost:this.getHost()}):this.options.token?this.sendMessage("privateDocumentation",{jwt:this.options.token,subdomain:this.options.subdomain||this.options.uuid,currentUrl:url,permalinksHost:this.getHost()}):this.options.preferences.permalinks&&this.sendMessage("change:url",{url:url}),this.sendMessage("init",{codeExamples:this.options.codeExamples,customFonts:this.options.customFonts,defaultHost:this.options.preferences.defaultHost,hosts:this.options.hosts,theme:this.options.theme}),this.initialized=!0},Embed.prototype.addCodeExample=function(languageName,renderMethod){var customRenderMethodConstructor;return customRenderMethodConstructor="var customRenderMethodConstructor = function() { return "+renderMethod.toString()+"; }; customRenderMethodConstructor.apply(customRenderMethodConstructor, []);",this.initialized?this.sendMessage("add:codeExample",{languageName:languageName,renderMethod:customRenderMethodConstructor}):this.queue.push({methodName:"sendMessage",args:["add:codeExample",{languageName:languageName,renderMethod:customRenderMethodConstructor}]})},Embed}(),Apiary.Embed=Embed;